# $Id$

# Build Options
export CFLAGS=-Wall -g 
CPPFLAGS=-I$(CMPIINCLUDE) -I .
LDFLAGS=-L .
LOADLIBES=

# Targets
SOURCES=ind_helper.c
DEPFILES=$(SOURCES:.c=.d)
OBJECTS=$(SOURCES:.c=.o)
LIBTARGETS=libind_helper.so 

#include env
# Environment settings
CMPIINCLUDE=../../..
LIBINSTALL=../../lib

#include rules
%.d: %.c
	@$(RM) $@
	$(CC) -MM $(CPPFLAGS) $< | sed 's/\($*\)\.o[ :]*/\1.o $@ : /g' > $@ 

lib%.so: %.o
	$(LINK.c) -shared $^ $(LOADLIBES) $(LDLIBS)-o $@ 

.PHONY: all clean distclean install uninstall $(SUBDIRS) 

lib%.so: $(OBJECTS)
	$(LINK.c) -shared $^ $(LOADLIBES) $(LDLIBS)-o $@


all: $(LIBTARGETS)

clean: 
	$(RM) $(OBJECTS) $(LIBTARGETS)

distclean: clean
	$(RM) $(DEPFILES) *~

install: $(LIBTARGETS)
	install -m 755 $(LIBTARGETS) $(LIBINSTALL)

uninstall: 
	cd $(LIBINSTALL) && $(RM) $(LIBTARGETS)

ifeq ($(MAKECMDGOALS),clean)
NODEPS=1
endif

ifeq ($(MAKECMDGOALS),distclean)
NODEPS=1
endif

ifndef NODEPS
include $(DEPFILES)
endif