#
# $Id$
#
# Package spec for @PACKAGE@
#

BuildRoot: /var/tmp/buildroot

Summary: Small Footprint CIM Broker
Name: @PACKAGE_TARNAME@
Version: @PACKAGE_VERSION@
Release: 0
Group: Systems Management/Base
License: Common Public License 1.0

Source0: ftp://www-126.ibm.com/pub/sblim/%{name}-%{version}.tar.bz2

Provides: cimserver

%Description
Small Footprint CIM Broker.

%Package schema
Summary: CIM Schema Files
Copyright: (C) Distributed Management Task Force
Group: Systems Management/Base
Requires: %{name}

%Description schema
DMTF CIM Schema files that can be used with the Small Footprint CIM Broker.

%prep

%setup -T -b 0 -n %{name}-%{version}

export PATCH_GET=0
#%patch0 -p1

%build

%configure --disable-debug
make

%install

if [ `id -ur` != 0 ]
then
# paranoia check 
	rm -rf $RPM_BUILD_ROOT 
fi

make DESTDIR=$RPM_BUILD_ROOT install
make DESTDIR=$RPM_BUILD_ROOT install-cimschema

# remove unused libtool files
rm -f $RPM_BUILD_ROOT/%{_libdir}/*a

echo "%defattr(-,root,root)" > _pkg_list

find $RPM_BUILD_ROOT/%{_datadir}/%{name} -type f | grep -v $RPM_BUILD_ROOT/%{_datadir}/%{name}/CIM >> _pkg_list
sed s?$RPM_BUILD_ROOT??g _pkg_list > _pkg_list_2
mv -f _pkg_list_2 _pkg_list
echo "%config %{_sysconfdir}/%{name}" >> _pkg_list
echo "%doc %{_datadir}/doc" >> _pkg_list
echo "%{_sysconfdir}/init.d/%{name}" >> _pkg_list
echo "%{_localstatedir}/lib/%{name}" >> _pkg_list
echo "%{_bindir}/*" >> _pkg_list
echo "%{_libdir}/*.so*" >> _pkg_list

echo =======================================
cat _pkg_list

%clean
if [ `id -ur` != 0 ]
then
# paranoia check 
	rm -rf $RPM_BUILD_ROOT 
fi

%post
/sbin/ldconfig

%postun
/sbin/ldconfig

%post schema
sfcbrepos -f 2> /dev/null
exit 0

%files schema
%{_datadir}/%{name}/CIM

%files -f _pkg_list
